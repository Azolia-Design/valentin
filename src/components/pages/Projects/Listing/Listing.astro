---
import { getImage } from 'astro:assets';
import { findImage } from '~/utils/images';
import Image from '~/components/common/Image.astro';
import ProjectListing from './ProjectListing';
import ArrowNext from '~/icons/arrow-next-orange.svg';
import ArrowPrev from '~/icons/arrow-prev-orange.svg';

const arrows = {
    next: await getImage({ src: ArrowNext, format: "svg" }),
    prev: await getImage({ src: ArrowPrev, format: "svg" })
};

const projects = [
    {
        link: "/project/defichain",
        year: 2020,
        title: "Definchain",
        roles: ["Product Design"],
        services: ["Website Design", "Mobile Application"],
        selling_points: ["Up 200% Conversion Rate", "3.233.222 Downloaded"],
        desc: "Techcombank has established itself as a leading bank through innovative technology and user-centered design.",
        thumbnail: await findImage('~/assets/images/define-hero.jpg')
    },
    {
        link: "/project/vietcombank",
        year: 2018,
        title: "Vietcom<br/>bank",
        roles: ["Design system", "Mobile app design", "Graphic Design"],
        services: ["Website Design",  "Graphic Design"],
        selling_points: ["Increase User Engagement by 150%", "5,000,000+ Active Users"],
        desc: "Vietcombank is one of the fastest growing global bank. Part of it is due to it's strong design thinking process.",
        thumbnail: await findImage('~/assets/images/define-hero-2.jpg'),
    },
    {
        link: "#",
        year: 2021,
        title: "BIDV",
        roles: ["Brand Identity", "UX Research", "Web Design"],
        services: ["Branding", "User Experience Research"],
        selling_points: ["Brand Recognition Boost by 120%", "Awarded Best Banking Website 2020"],
        desc: "BIDV's rebranding and UX improvements have significantly enhanced customer satisfaction and brand loyalty.",
        thumbnail: {
            src: "/images/project-thumb-1.jpg",
            alt: 'mockup iphone'
        }
    }
]
---
<section class="sc-projects__listing">
    <div class="projects__listing">
        <ProjectListing data={projects} arrows={arrows} client:visible={{ rootMargin: "100% 0% 100% 0%" }}/>
    </div>
</section>

<style lang="scss" is:global>
    @use '~/assets/styles/mixins' as *;
    .sc-projects__listing {
        position: relative;
        z-index: 6;
    }
    .projects__listing {
        &-main {
            padding-top: 17.14vh;
            padding-bottom: 8.76vh;
            height: 100%;
        }
    }
    .projects__sticky {
        position: relative;
        height: 100vh;
        > .container {
            z-index: 3;
            height: 100%;
            pointer-events: none;
        }
    }
    .projects__navigation {
        z-index: 2;
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        &-area {
            width: 100%;
            height: 50%;
        }
    }

    .projects__position {
        position: absolute;
        inset: 0 var(--container-padding);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        &-name {
            grid-column: 1/9;
            grid-row: 1/3;
            align-self: end;

            line-height: .835em;
            padding-bottom: 7.6vh;
        }
        &-info {
            grid-row: 1/2;
            grid-column: 13/14;
        }
        &-year {
            grid-column: 13/14;
            grid-row: 2/3;
            // line-height: .9em;
            padding-bottom: 9.2vh;
            align-self: end;
        }
    }
    .project {
        &-item-label {
            margin-bottom: 1rem;
            pointer-events: auto;
        }
        &__name {
            grid-column: 1/5;
            overflow-wrap: break-word;
            margin-top: -.12em;
            align-self: start;
            &-txt {
                justify-self: start;
                align-self: start;
                line-height: .835em;
                &.active {
                    pointer-events: auto;
                }
            }
        }
        &__desc {
            grid-column: 1/4;
            align-self: end;
            max-width: 32rem;
            &-txt {
                justify-self: start;
                align-self: end;
                &.active {
                    pointer-events: auto;
                }
            }
        }
        &__info {
            position: relative;
            z-index: 6;
            // grid-column: 6/9;
            grid-column: 6/16;
            grid-row: 1/2;
            align-self: start;
            justify-self: start;

            // display: flex;
            // width: 100%;
            // gap: 0 1.9rem;
            // margin-left: -1.9rem;
            &-empty {
                // flex: 0;
                // transition: flex .5s ease-in-out;
            }
            &-inner {
                display: flex;
                flex-direction: column;
                align-items: start;
                gap: 7.4rem 0;
                // margin-left: calc(var(--grid-gap) * -1);
            }
        }
        &__role,
        &__services,
        &__selling {
            display: flex;
            flex-direction: column;
            align-items: start;
            &-listing {
                align-self: start;
                justify-self: start;

                display: flex;
                flex-direction: column;
                align-items: start;
                &.active {
                    p {
                        pointer-events: auto;
                    }
                }
            }
        }
        &__year {
            grid-column: 6/8;
            align-self: end;
            pointer-events: auto;
            display: flex;
            gap: 0 .5rem;
            line-height: .9em;
        }
        &__thumbnail {
            height: 100%;
            &-wrap {
                grid-column: 9/15;
                grid-row: 1/3;
                position: relative;
                overflow: hidden;
            }
            &-listing {
                height: 100%;
                display: grid;
            }
            &-img {
                --clipping: 100%;

                position: relative;
                @include size(100%);
                clip-path: polygon(0% 0%, var(--clipping) 0, var(--clipping) var(--clipping), 0 var(--clipping));
                pointer-events: auto;
                &-inner {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    pointer-events: none;

                    @include size(100%);
                    img {
                        transform: translate(calc((100% - var(--clipping)) / -2), calc((100% - var(--clipping)) / -2));
                        position: absolute;
                    }
                }
            }
        }
        &__pagination {
            grid-column: -2/-1;
            grid-row: 1/3;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            &-main {
                display: flex;
                flex-direction: column;
                pointer-events: none;
            }
            &-item {
                position: relative;
                display: flex;
                justify-content: center;
                align-items:  center;
                width: 100%;
                height: 100%;
                &-wrap {
                    height: .2rem;
                    overflow: hidden;
                    padding: 1rem 0;
                    width: 6.6rem;
                    cursor: pointer;
                }
                &-img {
                    position: absolute;
                    z-index: 3;
                    width: 100%;
                    height: 100%;
                    overflow: hidden;
                    img {
                        height: 100%;
                        object-fit: cover;
                    }
                }
                &-progress {
                    z-index: 2;
                    position: absolute;
                    inset: 0;
                    border: .2rem solid transparent;
                    background: #fff border-box;
                    -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
                    mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
                    mask-composite: exclude;
                    opacity: .1;
                    transition: opacity .4s linear;
                    &-inner {
                        position: absolute;
                        z-index: 3;
                        // inset: -.15rem;
                        // border: .2rem solid transparent;
                        // @include size(150%);
                        // top: 50%;
                        // left: 50%;
                        // transform: translate(-50%, -50%);
                        background: linear-gradient(45deg, rgba(255, 61, 0, 0), rgba(255, 61, 0, 1)) border-box;
                        // -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
                        // mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
                        // mask-composite: exclude;
                        // opacity: 0;
                        // transition: opacity 1s cubic-bezier(0.16, 1, 0.3, 1) .3s;
                    }
                }
            }
            &-number {
                position: relative;
                padding-bottom: 2rem;
                .line {
                    position: absolute;
                    bottom: 0;
                }
             }
        }
    }
</style>