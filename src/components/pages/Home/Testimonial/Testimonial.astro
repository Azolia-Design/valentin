---
import { getImage } from 'astro:assets';
import Image from "~/components/common/Image.astro";
import TextTransClip from '~/components/common/TextTransClip';
import Testimonials from './Testimonials';
import Plus from "~/icons/plus.svg";

const testimonials = [
    { name: "Chris Azzopardi", position: "Product Consultant at Bitcoin.com", feedback: "I had the pleasure of working closely with Valentine at bitcoin.com. Throughout our time together, I was consistently impressed by their exceptional design skills, strategic thinking", image: { src: '/images/testi-pp.jpg', alt: '' } },
    { name: "Silvano D'Orazio", position: "Group Head of User Experience and Brand", feedback: "As the Head of Design at Tyme Bank, I had the distinct pleasure of working closely with Valentine over the past few years. contributions to a wide range of projects. He played a key role in developing our new mobile banking app, praised for its user-friendly design and intuitive functionality. Valentine was instrumental in creating our new internal branding guidelines, which have helped establish a more cohesive and consistent brand identity across all touchpoints.", image: { src: '/images/testi-pp.jpg', alt: '' } },
    { name: "Charles Mandin", position: "Senior PMO @ Nethermind", feedback: "Working with Valentine has always been a pleasure: he is focused and committed to excellence both in terms of quality and in terms of deadline. He showed a unique ability to be", image: { src: '/images/testi-pp.jpg', alt: '' } },
    { name: "Hai Van Tran", position: "Product Designer Lead", feedback: "As the Head of Design at Tyme Bank, I had the distinct pleasure of working closely with Valentine over the past few years. contributions to a wide range of projects. He played a key role in developing our new mobile banking app, praised for its user-friendly design and intuitive functionality. Valentine was instrumental in creating our new internal branding guidelines, which have helped establish a more cohesive and consistent brand identity across all touchpoints.", image: { src: '/images/testi-pp.jpg', alt: '' } },
    { name: "Andrew Michael Todd", position: "Head Of Marketing and Growth at Bitcoin.com", feedback: "I am delighted to recommend Valentine, a former Lead Designer at Bitcoin.com. During his time with us Valentine showcased exceptional product design and leadership skills", image: { src: '/images/testi-pp.jpg', alt: '' } }
]

const PlusIc = await getImage({ src: Plus, format: "svg" });
const itemLength = testimonials.length;
---
<div class="home__testi-wrap">
    <section class="home__testi">
        <div class="container">
            <h2 class="upper home__testi-title grid">
                <span class="heading h2 fw-bold home__testi-title-txt">
                    <TextTransClip client:visible={{ rootMargin: "100% 0% 100% 0%" }}>What</TextTransClip>
                </span>
                <span class="heading h2 fw-bold home__testi-title-txt">
                    <TextTransClip client:visible={{ rootMargin: "100% 0% 100% 0%" }}>people say</TextTransClip>
                </span>
                <span class="heading h2 fw-bold home__testi-title-txt">
                    <TextTransClip client:visible={{ rootMargin: "100% 0% 100% 0%" }}>About<span class="cl-txt-title"> me</span></TextTransClip>
                </span>
                <span class="fs-20 cl-txt-desc fw-reg upper home__testi-title-label">(Testimonials)</span>
            </h2>
            <div class="home__testi-listing" style={{ '--itemLength': itemLength }}>
                <Testimonials data={testimonials} plusIc={PlusIc.src} client:visible={{ rootMargin: "100% 0% 100% 0%" }}>
                    <Image
                        src={'~/assets/images/testi-blur.png'}
                        widths={[400, 768]}
                        width={90}
                        height={120}
                        alt={'orange blur'}
                        layout="cover"
                        loading="lazy"
                        decoding="async"
                        slot="blur"
                        class="home__testi-item-image-blur"
                    />
                </Testimonials>
            </div>
        </div>
    </section>
</div>

<style lang="scss" is:global>
    @use '~/assets/styles/mixins' as *;
    .home__testi {
        position: relative;
        z-index: 4;
        padding-bottom: 5rem;
        background-color: var(--cl-dm-bg);
        pointer-events: none;
        &-title {
            position: relative;
            padding-block: 12rem;
            gap: 1rem 0;
            @include md {
                padding-block: 12rem 8rem;
            }
            &-label {
                grid-column: 1/3;
                grid-row: 1/2;
                @include md {
                    @include text(16);
                }
            }
            &-txt {
                line-height: .835em;
                @include md {
                    @include text(dis2);
                    line-height: 0.835em;
                }
                &:nth-child(1) {
                    grid-column: 5/16;
                    @include md {
                        grid-column: 4/-1;
                    }
                }
                &:nth-child(2) {
                    grid-column: 1/16;
                    margin-left: 1.8rem;
                    @include md {
                        grid-column: 1/-1;
                    }
                }
                &:nth-child(3) {
                    grid-column: 5/16;
                    @include md {
                        grid-column: 4/-1;
                    }
                }
            }
        }
        &-listing {
            --scale-factor: 3;
            margin-bottom: calc((((6.4rem + 7.6rem) * (var(--scale-factor) - 1)) * var(--itemLength)) * -1);
            @include md {
                --scale-factor: 2;
                margin-bottom: calc((((4.8rem + 4.8rem) * (var(--scale-factor) - 1)) * var(--itemLength)) * -1);
            }
            &-inner {
                height: calc((12rem + ((6.4rem + 7.6rem) * var(--scale-factor))) * var(--itemLength));
                @include md {
                    height: calc((13rem + ((4.8rem + 4.8rem) * var(--scale-factor))) * var(--itemLength));
                }
            }
        }
        &-item {
            position: relative;
            padding-block: calc(6.4rem * var(--scale-factor)) calc(7.6rem * var(--scale-factor));
            display: grid;
            grid-template-columns: 1fr;
            pointer-events: auto;
            @include md {
                padding-block: calc(4.8rem * var(--scale-factor)) calc(4.8rem * var(--scale-factor));
            }
            .line {
                position: absolute;
                top: 0;
            }
            > * {
                pointer-events: none;
            }
            &-content,
            &-image {
                grid-area: 1/1/2/2;
            }
            &-order {
                grid-area: 1/1/2/2;

                opacity: 1;
                transition: opacity .5s cubic-bezier(.74, .06, .4, .92);
            }
            &-info {
                grid-column: 5/9;

                display: flex;
                flex-direction: column;
                gap: 1rem 0;

                opacity: .3;
                transition: opacity .5s cubic-bezier(.74, .06, .4, .92);

                @include md {
                    grid-column: 3/6;
                }
            }
            &-name {
                @include text(h5);
            }
            &-content {

            }
            &-feedback-wrap {
                grid-column: 10/-1;
                display: grid;
                height: (2.4rem * 1.3 * 3);
                align-items: start;
                overflow: hidden;

                opacity: .3;
                transition: opacity .5s cubic-bezier(.74, .06, .4, .92);
                @include md {
                    grid-column: 7/11;
                    height: (1.6rem * 1.4 * 3);
                    @include text(16);
                }
            }
            &-feedback {
                grid-area: 1/1/2/2;
                &-inner {

                }
                &.shorten {
                    display: -webkit-box;
                    -webkit-box-orient: vertical;
                    text-overflow: ellipsis;
                    -webkit-line-clamp: 3;
                }
                &.fully {
                    opacity: 0;
                }
            }
            &-toggle {
                display: none;
                @include md {
                    grid-column: 12/13;

                    display: grid;
                    align-items: center;
                    justify-content: center;

                    @include size(4.4rem);
                    border-radius: 50%;
                    border: 1px solid var(--cl-dm-border);
                    background-color: rgba(255, 61, 0, 0.04);
                    backdrop-filter: blur(1rem);
                    transition: transform .5s cubic-bezier(.455, .03, .515, .955), background-color .3s ease-out .1s;
                    span {
                        grid-area: 1/1/2/2;
                        line-height: 1em;
                        height: 1px;
                        width: 1.6rem;
                        background-color: var(--cl-orange);
                        transition: background-color .3s ease-out .25s, opacity .2s ease-in-out .1s;
                        &:last-child {
                            transform: rotate(90deg);
                        }
                    }
                }
            }
            &-image {
                position: relative;
                @include size(9rem, 12rem);
                overflow: hidden;

                display: flex;
                justify-content: center;
                align-items: center;
                @include md {
                    @include size(8rem, 10.8rem);
                }
                &-main {
                    opacity: 0;
                    transform: scale(1.2);
                    transform-origin: right bottom;
                    transition: transform .6s cubic-bezier(0.33, 1, 0.68, 1) .1s, opacity 1s cubic-bezier(0.16, 1, 0.3, 1) .15s;
                }
                &-blur {
                    position: absolute;
                    inset: 0;
                    opacity: 0;
                    transition: opacity .8s cubic-bezier(.74, .06, .4, .92) .1s;
                }
            }
            &.active {
                .home__testi-item {
                    &-image-main {
                        transform: scale(1);
                        opacity: 1;
                        transition-delay: 0;
                    }
                    &-image-blur {
                        opacity: 1;
                        transition-delay: 0;
                    }
                    &-order {
                        opacity: 0;
                        transition-delay: 0;
                    }
                    &-feedback {
                        &.shorten {
                            opacity: 0;
                        }
                        &.fully {
                            opacity: 1;
                        }
                    }
                    &-info, &-feedback-wrap {
                        opacity: 1;
                        transition-delay: 0;
                    }
                    &-toggle {
                        transform: rotate(-180deg);
                        background-color: var(--cl-orange);

                        span {
                            background-color: var(--cl-white);
                            &:last-child {
                                opacity: 0;
                            }
                        }
                    }
                }
            }
            &:hover {
                @include md-up {
                    .home__testi-item {
                        &-image-main {
                            transform: scale(1);
                            opacity: 1;
                            transition-delay: 0;
                        }
                        &-image-blur {
                            opacity: 1;
                            transition-delay: 0;
                        }
                        &-info, &-feedback-wrap {
                            opacity: 1;
                            transition-delay: 0;
                        }
                    }
                }
            }
        }
    }
</style>