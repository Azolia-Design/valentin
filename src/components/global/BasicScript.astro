---
declare global {
    interface Window {
        swup: any;
    }
}
---
<script src="https://cdnwf.bear.plus/Greensock/DrawSVG.js" type="text/javascript"></script>
<script src="https://cdnwf.bear.plus/Greensock/CustomEase.js" type="text/javascript"></script>
<script>
    import { initLenis, getLenis } from "~/components/core/lenis";
    import { initMouseFollower, getCursor } from '~/components/core/cursor';
    import { initSwup, getSwup } from '~/components/core/swup';

    // import CMS from "decap-cms-app";
    // CMS.init();

    const onLoad = function () {
        console.log("on load")

        let ticking = true;

        const applyOnScroll = (scrollPos) => {
            function headerOnScroll(scrollPos) {
                const header = document.querySelector('header');
                if (!header) return;
                if (scrollPos > (header.offsetHeight * 5) && !header.classList.contains('on-scroll')) {
                    header.classList.add("on-scroll");
                }
                else if (scrollPos <= (header.offsetHeight * 5) && header.classList.contains('on-scroll')) {
                    header.classList.remove('on-scroll');
                }
                ticking = false;
            }
            headerOnScroll(scrollPos);;
        }
        applyOnScroll(window.scrollY);

        if (!getLenis()) {
            initLenis();
        }
        else {
            getLenis().on('scroll', function(inst) {
                let scrollPos = inst.scroll;
                if (!ticking) {
                    requestAnimationFrame(() => {
                        applyOnScroll(scrollPos);
                    });
                    ticking = true;
                }
            })
        }
        if (!getCursor()) {
            initMouseFollower();
        }
        if (!getSwup()) {
            initSwup();
        }
    }

    const onPageShow = function () {
        console.log("on page show")
    }

    window.onload = onLoad;
    window.onpageshow = onPageShow;
</script>
